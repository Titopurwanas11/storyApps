(()=>{"use strict";var n={16:(n,e,t)=>{t.d(e,{A:()=>s});var o=t(601),a=t.n(o),r=t(314),i=t.n(r)()(a());i.push([n.id,'/* --- Global Reset & Basic Styles --- */\n/* Pastikan ini di awal file style.css Anda */\n* {\n    box-sizing: border-box; /* Pastikan padding dan border termasuk dalam width/height */\n    margin: 0;\n    padding: 0;\n}\n\nhtml, body {\n    width: 100%;\n    height: 100%;\n    /* overflow: hidden; */ /* Hapus ini agar scrolling di body/main berfungsi, sudah dihapus di bawah */\n    font-family: \'Poppins\', sans-serif; /* Menggunakan Poppins, diimpor di index.html */\n    line-height: 1.6;\n    background-color: #eef2f7; /* Latar belakang abu-abu muda yang lebih lembut */\n    color: #343a40; /* Warna teks dasar yang sedikit lebih gelap */\n    display: flex; /* Jadikan body flex container untuk mengatur header, app, footer */\n    flex-direction: column; /* Susun elemen secara vertikal */\n}\n\n/* --- Custom Scrollbar (untuk tampilan yang lebih bersih) --- */\n/* Hanya terlihat di browser yang mendukung (Chrome, Edge, Safari) */\n::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n}\n::-webkit-scrollbar-track {\n    background: #f0f2f5;\n    border-radius: 10px;\n}\n::-webkit-scrollbar-thumb {\n    background: #c2c9d6;\n    border-radius: 10px;\n}\n::-webkit-scrollbar-thumb:hover {\n    background: #9aa4b7;\n}\n\n\n/* --- View Transition (biarkan saja) --- */\n::view-transition-old(root),\n::view-transition-new(root) {\n    animation-duration: 0.5s;\n}\n\n/* --- Aplikasi Header --- */\n/* Gaya untuk <header id="appHeader"> yang baru di index.html */\n#appHeader {\n    background-color: #ffffff;\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1); /* Bayangan yang lebih tegas */\n    padding: 1.2rem 2.5rem; /* Padding lebih besar */\n    display: flex;\n    align-items: center;\n    justify-content: space-between; /* Judul di kiri, Nav di kanan */\n    min-height: 75px; /* Tinggi minimum header sedikit lebih tinggi */\n    flex-shrink: 0; /* Mencegah header menyusut */\n    z-index: 1000; /* Pastikan di atas konten lain */\n}\n\n#appHeader .app-title {\n    font-size: 2rem; /* Lebih besar */\n    color: #0069d9; /* Warna biru yang sedikit lebih gelap dan kaya */\n    font-weight: 700;\n    margin: 0; /* Hapus margin default h1 */\n    letter-spacing: -0.8px; /* Lebih rapat */\n    text-shadow: 1px 1px 2px rgba(0,0,0,0.05); /* Sedikit bayangan teks */\n}\n\n/* --- Skip Link --- */\n.skip-link {\n    position: absolute;\n    top: -60px; /* Sembunyikan lebih jauh di luar layar */\n    left: 0;\n    padding: 12px 18px;\n    background: #007bff;\n    color: white;\n    font-weight: 600;\n    z-index: 2000; /* Pastikan di atas segalanya */\n    text-decoration: none;\n    border-radius: 0 0 10px 10px; /* Sudut lebih membulat */\n    transition: top 0.3s ease-in-out, background-color 0.2s ease;\n}\n\n.skip-link:focus {\n    top: 0;\n    background-color: #0056b3;\n}\n\n/* --- App Container (Main content wrapper) --- */\n#app {\n    flex-grow: 1; /* Biarkan #app mengambil semua ruang tersisa */\n    display: flex;\n    flex-direction: column; /* Konten di dalamnya tersusun vertikal */\n    background-color: #eef2f7; /* Latar belakang sama dengan body */\n}\n\n/* --- Navigasi Utama Aplikasi (di dalam #appHeader) --- */\n/* Target #mainNav sekarang, bukan hanya \'nav\' */\n#mainNav {\n    display: flex;\n    align-items: center;\n    gap: 1.2rem; /* Spasi antar tombol lebih besar */\n    flex-wrap: wrap; /* Izinkan tombol wrap di layar kecil */\n    justify-content: flex-end; /* Pastikan tombol di kanan */\n}\n\n#mainNav button { /* Gaya tombol di navbar */\n    background-color: #007bff;\n    color: white;\n    padding: 12px 22px; /* Padding lebih besar */\n    border: none;\n    border-radius: 30px; /* Lebih bulat */\n    cursor: pointer;\n    font-size: 1rem; /* Sedikit lebih besar */\n    font-weight: 500;\n    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;\n    box-shadow: 0 4px 12px rgba(0,123,255,0.25); /* Bayangan lebih terlihat */\n    outline: none; /* Hapus outline default */\n}\n\n#mainNav button:hover {\n    background-color: #0056b3;\n    transform: translateY(-3px); /* Efek naik lebih jelas */\n    box-shadow: 0 6px 18px rgba(0,123,255,0.35);\n}\n\n#mainNav button:active {\n    transform: translateY(0);\n    box-shadow: 0 2px 8px rgba(0,123,255,0.2);\n}\n\n#mainNav button:focus-visible { /* Gaya fokus untuk aksesibilitas */\n    outline: 2px solid #007bff;\n    outline-offset: 3px;\n    border-radius: 30px;\n}\n\n/* Tombol Logout di navbar */\n#mainNav button#logoutButton {\n    background-color: #dc3545;\n    box-shadow: 0 4px 12px rgba(220,53,69,0.25);\n}\n\n#mainNav button#logoutButton:hover {\n    background-color: #c82333;\n    box-shadow: 0 6px 18px rgba(220,53,69,0.35);\n}\n\n#mainNav button#logoutButton:focus-visible {\n    outline: 2px solid #dc3545;\n}\n\n\n/* --- Main Content Area (Untuk Konten Halaman Spesifik) --- */\n/* Ini adalah \'main\' yang disuntikkan oleh showLogin/showStories, dll. */\nmain#main {\n    flex-grow: 1;\n    padding: 2rem; /* Padding lebih besar */\n    overflow-y: auto; /* Izinkan scroll di dalam main content jika isinya panjang */\n    display: flex;\n    flex-direction: column;\n    align-items: center; /* Tengah konten secara horizontal di main */\n}\n\nmain#main h1, main#main h2 {\n    color: #343a40;\n    margin-bottom: 1.5rem; /* Margin lebih besar */\n    font-weight: 600;\n    text-align: center;\n    width: 100%;\n}\n\n/* --- Forms (Login, Register, Add Story) --- */\n.form-container {\n    padding: 3rem; /* Padding lebih besar */\n    max-width: 500px; /* Lebih lebar */\n    margin: 2.5rem auto; /* Margin lebih besar */\n    background: #ffffff;\n    border-radius: 16px; /* Lebih membulat */\n    box-shadow: 0 15px 40px rgba(0,0,0,0.15); /* Bayangan lebih dalam dan halus */\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem; /* Spasi antar elemen form lebih besar */\n    text-align: left;\n    position: relative; /* Untuk positioning error message */\n}\n\n.form-container h1 {\n    font-size: 2.5rem; /* Lebih besar */\n    color: #0069d9; /* Warna biru yang lebih kaya */\n    margin-bottom: 2rem; /* Spasi lebih besar */\n}\n\n.form-container label {\n    font-weight: 600;\n    margin-bottom: 0.6rem; /* Margin lebih besar */\n    display: block;\n    color: #555;\n}\n\n.form-container input[type="email"],\n.form-container input[type="password"],\n.form-container input[type="text"],\n.form-container textarea {\n    width: 100%;\n    padding: 16px 20px; /* Padding lebih besar */\n    border: 1px solid #dcdfe6; /* Border lebih lembut */\n    border-radius: 10px; /* Lebih membulat */\n    font-size: 1.05rem;\n    transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;\n    background-color: #fcfcfc; /* Latar belakang input lebih terang */\n}\n\n.form-container input:focus,\n.form-container textarea:focus {\n    border-color: #007bff;\n    box-shadow: 0 0 0 4px rgba(0,123,255,0.25); /* Efek focus lebih jelas */\n    outline: none;\n    background-color: #ffffff; /* Latar belakang putih saat fokus */\n}\n\n.form-container textarea {\n    min-height: 150px; /* Tinggi minimum textarea lebih tinggi */\n    resize: vertical;\n}\n\n.form-container button[type="submit"] {\n    background-color: #007bff;\n    color: white;\n    padding: 16px 32px; /* Padding lebih besar */\n    border: none;\n    border-radius: 35px; /* Tombol lebih bulat */\n    cursor: pointer;\n    font-size: 1.2rem; /* Lebih besar */\n    font-weight: 600;\n    margin-top: 2.5rem;\n    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;\n    box-shadow: 0 6px 20px rgba(0,123,255,0.3); /* Bayangan lebih terlihat */\n    outline: none;\n}\n\n.form-container button[type="submit"]:hover {\n    background-color: #0056b3;\n    transform: translateY(-4px); /* Efek naik lebih jelas */\n    box-shadow: 0 10px 25px rgba(0,123,255,0.4);\n}\n.form-container button[type="submit"]:active {\n    transform: translateY(0);\n    box-shadow: 0 4px 12px rgba(0,123,255,0.2);\n}\n\n.form-container button[type="submit"]:focus-visible { /* Gaya fokus untuk submit button */\n    outline: 2px solid #007bff;\n    outline-offset: 4px;\n    border-radius: 35px;\n}\n\n.form-container p {\n    margin-top: 2rem;\n    font-size: 1rem; /* Sedikit lebih besar */\n    color: #6c757d;\n    text-align: center;\n}\n\n.form-container p a {\n    color: #007bff;\n    text-decoration: none;\n    font-weight: 600;\n    transition: color 0.2s ease;\n}\n\n.form-container p a:hover {\n    color: #0056b3;\n    text-decoration: underline;\n}\n\n/* --- Photo Input & Camera --- */\n.photo-input {\n    display: flex;\n    flex-direction: column;\n    gap: 15px; /* Spasi lebih besar */\n    align-items: stretch;\n    margin-top: 1rem;\n}\n\n.photo-input input[type="file"] {\n    padding: 12px;\n    border: 1px solid #dcdfe6;\n    border-radius: 10px;\n    background-color: #fcfcfc;\n    cursor: pointer;\n    font-size: 0.95rem;\n    transition: border-color 0.2s ease, box-shadow 0.2s ease;\n}\n\n.photo-input input[type="file"]:focus {\n    border-color: #007bff;\n    box-shadow: 0 0 0 4px rgba(0,123,255,0.25);\n}\n\n.photo-input button {\n    background-color: #28a745; /* Warna hijau */\n    color: white;\n    padding: 14px 28px; /* Padding lebih besar */\n    border: none;\n    border-radius: 30px;\n    cursor: pointer;\n    font-size: 1.1rem;\n    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;\n    box-shadow: 0 5px 15px rgba(40,167,69,0.3);\n    outline: none;\n}\n\n.photo-input button:hover {\n    background-color: #218838;\n    transform: translateY(-3px);\n    box-shadow: 0 8px 20px rgba(40,167,69,0.4);\n}\n.photo-input button:active {\n    transform: translateY(0);\n    box-shadow: 0 3px 10px rgba(40,167,69,0.2);\n}\n.photo-input button:focus-visible {\n    outline: 2px solid #28a745;\n    outline-offset: 3px;\n    border-radius: 30px;\n}\n\n\n.photo-input span {\n    margin-top: 10px;\n    font-style: italic;\n    color: #28a745;\n    font-size: 0.95rem;\n    text-align: center;\n}\n\n#cameraVideo {\n    width: 100%;\n    max-width: 480px; /* Menyesuaikan max-width form */\n    display: block;\n    margin: 0 auto 20px auto; /* Margin lebih besar */\n    border: 3px solid #007bff; /* Border biru yang jelas */\n    border-radius: 16px; /* Lebih membulat */\n    background-color: black;\n    box-shadow: 0 5px 20px rgba(0,0,0,0.3);\n}\n\n\n/* --- Map & Coordinates --- */\n#map {\n    height: 500px; /* Tinggi default peta lebih besar */\n    width: 100%;\n    border-radius: 16px; /* Lebih membulat */\n    box-shadow: 0 8px 25px rgba(0,0,0,0.15); /* Bayangan lebih terlihat */\n    margin: 3rem 0; /* Margin lebih besar */\n    overflow: hidden;\n    position: relative; /* Penting untuk loader */\n}\n\n#coordinates {\n    text-align: center;\n    margin-top: 1rem;\n    font-size: 1.05rem;\n    color: #555;\n    padding: 12px 20px;\n    border: 1px dashed #c2c9d6; /* Border putus-putus lebih terlihat */\n    border-radius: 10px;\n    background-color: #f8f9fa;\n    box-shadow: inset 0 2px 5px rgba(0,0,0,0.08); /* Bayangan inset lebih terlihat */\n}\n\n.map-loader {\n    height: 100%;\n    display: grid;\n    place-items: center;\n    background-color: rgba(255, 255, 255, 0.95); /* Lebih buram */\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    z-index: 10;\n}\n\n/* --- Story Grid & Card --- */\n.story-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));\n    gap: 3rem; /* Jarak antar kartu lebih besar */\n    padding: 2.5rem 0; /* Padding lebih besar */\n    margin-top: 3rem;\n    width: 100%;\n    max-width: 1400px; /* Batasi lebar grid lebih besar */\n    margin-left: auto;\n    margin-right: auto;\n}\n\n.story-card {\n    background-color: #ffffff;\n    border: none;\n    padding: 0;\n    border-radius: 16px;\n    overflow: hidden;\n    box-shadow: 0 15px 40px rgba(0,0,0,0.1);\n    transition: transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out;\n    display: flex;\n    flex-direction: column;\n    min-height: 450px;\n}\n\n.story-card:hover {\n    transform: translateY(-10px);\n    box-shadow: 0 20px 50px rgba(0,0,0,0.2);\n}\n\n.story-card img {\n    width: 100%;\n    height: 280px;\n    object-fit: cover;\n    display: block;\n    border-bottom: 1px solid #f8f9fa;\n}\n\n.story-content {\n    padding: 1.8rem;\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n}\n\n.story-content h3 {\n    font-size: 1.6rem;\n    margin-top: 0;\n    margin-bottom: 0.8rem;\n    color: #0069d9;\n    font-weight: 600;\n}\n\n.story-content p {\n    font-size: 1.05rem;\n    color: #555;\n    margin-bottom: 1.5rem;\n    flex-grow: 1;\n}\n\n.story-content time {\n    font-size: 0.9rem;\n    color: #888;\n    display: block;\n    margin-top: 1rem;\n    font-style: italic;\n    text-align: right;\n}\n\n.map-marker {\n    font-size: 1.05rem;\n    color: #28a745;\n    margin-top: 1.2rem;\n    display: inline-flex;\n    align-items: center;\n    gap: 10px;\n    font-weight: 600;\n}\n\n/* --- Toast Messages --- */\n.toast {\n    position: fixed;\n    bottom: 40px;\n    right: 40px;\n    padding: 18px 36px;\n    border-radius: 12px;\n    color: white;\n    z-index: 2000;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.35);\n    font-size: 1.1rem;\n    font-weight: 500;\n    opacity: 0;\n    animation: fadeInOutToast 4.5s forwards;\n    min-width: 320px;\n    text-align: center;\n}\n\n.toast.error { background: #dc3545; }\n.toast.success { background: #28a745; }\n.toast.info { background: #17a2b8; }\n\n@keyframes fadeInOutToast {\n    0% { opacity: 0; transform: translateY(50px); }\n    10% { opacity: 1; transform: translateY(0); }\n    90% { opacity: 1; transform: translateY(0); }\n    100% { opacity: 0; transform: translateY(50px); }\n}\n\n/* --- Error Handling --- */\n.error {\n    border-color: #dc3545 !important;\n    box-shadow: 0 0 0 5px rgba(220,53,69,0.3) !important;\n}\n\n.error-message {\n    color: #dc3545;\n    font-size: 0.95rem;\n    margin-top: 0.6rem;\n    text-align: left;\n    font-weight: 500;\n}\n\n/* --- Loading Spinner --- */\n.loading-spinner {\n    width: 40px;\n    height: 40px;\n    border: 6px solid rgba(255,255,255,.4);\n    border-top-color: #fff;\n    animation: spin 0.7s ease-in-out infinite;\n}\n\n/* --- Leaflet Map Overrides --- */\n.leaflet-container {\n    font-family: \'Poppins\', sans-serif;\n    border-radius: 16px;\n    overflow: hidden;\n}\n\n.leaflet-popup-content {\n    padding: 15px 20px;\n    font-size: 1rem;\n}\n\n.leaflet-popup-content img {\n    border-radius: 8px;\n    margin: 10px auto 15px auto;\n}\n\n.leaflet-popup-content h3 {\n    font-size: 1.3rem;\n    margin-bottom: 10px;\n}\n\n.leaflet-popup-content p {\n    margin-bottom: 10px;\n}\n\n.leaflet-popup-content small {\n    font-size: 0.85rem;\n    margin-top: 10px;\n}\n\n.clear-data-button {\n    background-color: #6c757d; /* Warna abu-abu */\n    color: white;\n    padding: 10px 20px;\n    border: none;\n    border-radius: 25px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    font-weight: 500;\n    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n    outline: none;\n    margin-top: 1.5rem; /* Spasi dari elemen di atasnya */\n    align-self: center; /* Tengah tombol di dalam main */\n}\n\n.clear-data-button:hover {\n    background-color: #5a6268;\n    transform: translateY(-2px);\n    box-shadow: 0 6px 18px rgba(0,0,0,0.25);\n}\n\n.clear-data-button:active {\n    transform: translateY(0);\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n\n.clear-data-button:focus-visible {\n    outline: 2px solid #6c757d;\n    outline-offset: 3px;\n    border-radius: 25px;\n}\n\n/* --- Responsive Adjustments (Tambahan untuk tombol clear) --- */\n@media (max-width: 768px) {\n    .clear-data-button {\n        padding: 8px 15px;\n        font-size: 0.85rem;\n        margin-top: 1rem;\n        width: 80%; /* Lebar di mobile */\n    }\n}\n\n/* --- Aplikasi Footer --- */\n#appFooter {\n    background-color: #343a40;\n    color: #f8f9fa;\n    padding: 1.2rem 2rem;\n    text-align: center;\n    font-size: 0.95rem;\n    box-shadow: 0 -3px 10px rgba(0,0,0,0.1);\n    flex-shrink: 0;\n}\n\n#appFooter p {\n    margin: 0;\n}\n\n\n\n\n/* --- Responsive Adjustments --- */\n@media (max-width: 992px) { /* Medium devices (tablets) */\n    #appHeader {\n        padding: 1rem 1.5rem;\n        min-height: 65px;\n    }\n    #appHeader .app-title {\n        font-size: 1.6rem;\n    }\n    #mainNav {\n        gap: 0.8rem;\n    }\n    #mainNav button {\n        padding: 10px 18px;\n        font-size: 0.9rem;\n    }\n    main#main {\n        padding: 1.5rem;\n    }\n    .form-container {\n        padding: 2rem;\n        margin: 1.5rem auto;\n        max-width: 90%;\n        gap: 1rem;\n    }\n    .form-container h1 {\n        font-size: 2rem;\n        margin-bottom: 1.5rem;\n    }\n    .form-container input,\n    .form-container textarea {\n        padding: 14px 16px;\n    }\n    .form-container button[type="submit"] {\n        padding: 14px 28px;\n        font-size: 1.1rem;\n        margin-top: 2rem;\n    }\n    .photo-input button {\n        padding: 10px 20px;\n        font-size: 1rem;\n    }\n    #cameraVideo {\n        max-width: 95%;\n        margin: 10px auto;\n    }\n    #map {\n        height: 400px;\n        margin: 2rem 0;\n    }\n    .story-grid {\n        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n        gap: 2rem;\n        padding: 1.5rem 0;\n        margin-top: 2rem;\n    }\n    .story-card {\n        min-height: 400px;\n    }\n    .story-card img {\n        height: 220px;\n    }\n    .story-content {\n        padding: 1.5rem;\n    }\n    .story-content h3 {\n        font-size: 1.4rem;\n    }\n    .story-content p {\n        font-size: 0.9rem;\n    }\n    .map-marker {\n        font-size: 0.9rem;\n    }\n    .toast {\n        bottom: 15px;\n        right: 15px;\n        left: 15px;\n        padding: 14px 28px;\n        font-size: 0.95rem;\n        min-width: unset;\n    }\n    #appFooter {\n        padding: 1rem 1.5rem;\n        font-size: 0.9rem;\n    }\n}\n\n@media (max-width: 768px) { /* Adjustments for smaller tablets and larger phones */\n    #appHeader .app-title {\n        font-size: 1.2rem; /* Make title smaller on very small screens */\n    }\n    .form-container {\n        padding: 1.2rem;\n        margin: 0.8rem auto;\n    }\n    .form-container h1 {\n        font-size: 1.5rem;\n        margin-bottom: 0.8rem;\n    }\n    .form-container input,\n    .form-container textarea {\n        padding: 10px 12px;\n        font-size: 0.9rem;\n    }\n    .form-container button[type="submit"] {\n        padding: 10px 20px;\n        font-size: 0.95rem;\n        margin-top: 1.5rem;\n    }\n    .photo-input button {\n        padding: 8px 15px;\n        font-size: 0.85rem;\n    }\n    #map {\n        height: 200px !important; /* Even shorter map */\n        margin: 1rem 0;\n    }\n    .story-grid {\n        gap: 1rem;\n        padding: 0.5rem 0;\n        margin-top: 1rem;\n    }\n    .story-card {\n        min-height: auto; /* Allow height to auto adjust */\n    }\n    .story-card img {\n        height: 140px; /* Even shorter images */\n    }\n    .story-content {\n        padding: 0.8rem;\n    }\n    .story-content h3 {\n        font-size: 1.1rem;\n    }\n    .story-content p {\n        font-size: 0.8rem;\n    }\n    .map-marker {\n        font-size: 0.8rem;\n    }\n    .toast {\n        padding: 10px 20px;\n        font-size: 0.85rem;\n    }\n    #appFooter {\n        font-size: 0.65rem;\n    }\n}\n\n@media (max-width: 480px) { /* Very small phones */\n    #appHeader {\n        padding: 0.5rem 0.8rem;\n    }\n    #appHeader .app-title {\n        font-size: 1.1rem;\n    }\n    #mainNav button {\n        padding: 6px 12px;\n        font-size: 0.75rem;\n    }\n    .form-container {\n        padding: 0.8rem;\n    }\n    .form-container h1 {\n        font-size: 1.3rem;\n    }\n    .photo-input input[type="file"] {\n        font-size: 0.85rem;\n    }\n    .photo-input button {\n        font-size: 0.8rem;\n    }\n    #cameraVideo {\n        margin: 5px auto;\n    }\n}',""]);const s=i},56:(n,e,t)=>{n.exports=function(n){var e=t.nc;e&&n.setAttribute("nonce",e)}},72:n=>{var e=[];function t(n){for(var t=-1,o=0;o<e.length;o++)if(e[o].identifier===n){t=o;break}return t}function o(n,o){for(var r={},i=[],s=0;s<n.length;s++){var d=n[s],l=o.base?d[0]+o.base:d[0],c=r[l]||0,p="".concat(l," ").concat(c);r[l]=c+1;var m=t(p),u={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==m)e[m].references++,e[m].updater(u);else{var g=a(u,o);o.byIndex=s,e.splice(s,0,{identifier:p,updater:g,references:1})}i.push(p)}return i}function a(n,e){var t=e.domAPI(e);return t.update(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap&&e.supports===n.supports&&e.layer===n.layer)return;t.update(n=e)}else t.remove()}}n.exports=function(n,a){var r=o(n=n||[],a=a||{});return function(n){n=n||[];for(var i=0;i<r.length;i++){var s=t(r[i]);e[s].references--}for(var d=o(n,a),l=0;l<r.length;l++){var c=t(r[l]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}r=d}}},113:n=>{n.exports=function(n,e){if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},314:n=>{n.exports=function(n){var e=[];return e.toString=function(){return this.map((function(e){var t="",o=void 0!==e[5];return e[4]&&(t+="@supports (".concat(e[4],") {")),e[2]&&(t+="@media ".concat(e[2]," {")),o&&(t+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),t+=n(e),o&&(t+="}"),e[2]&&(t+="}"),e[4]&&(t+="}"),t})).join("")},e.i=function(n,t,o,a,r){"string"==typeof n&&(n=[[null,n,void 0]]);var i={};if(o)for(var s=0;s<this.length;s++){var d=this[s][0];null!=d&&(i[d]=!0)}for(var l=0;l<n.length;l++){var c=[].concat(n[l]);o&&i[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),a&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=a):c[4]="".concat(a)),e.push(c))}},e}},540:n=>{n.exports=function(n){var e=document.createElement("style");return n.setAttributes(e,n.attributes),n.insert(e,n.options),e}},601:n=>{n.exports=function(n){return n[1]}},659:n=>{var e={};n.exports=function(n,t){var o=function(n){if(void 0===e[n]){var t=document.querySelector(n);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(n){t=null}e[n]=t}return e[n]}(n);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},825:n=>{n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=n.insertStyleElement(n);return{update:function(t){!function(n,e,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var a=void 0!==t.layer;a&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,a&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var r=t.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(o,n,e.options)}(e,n,t)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(e)}}}}},e={};function t(o){var a=e[o];if(void 0!==a)return a.exports;var r=e[o]={id:o,exports:{}};return n[o](r,r.exports,t),r.exports}t.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},t.d=(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},t.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),t.nc=void 0;var o=t(72),a=t.n(o),r=t(825),i=t.n(r),s=t(659),d=t.n(s),l=t(56),c=t.n(l),p=t(540),m=t.n(p),u=t(113),g=t.n(u),h=t(16),f={};f.styleTagTransform=g(),f.setAttributes=c(),f.insert=d().bind(null,"head"),f.domAPI=i(),f.insertStyleElement=m(),a()(h.A,f),h.A&&h.A.locals&&h.A.locals;const b=(n,e)=>e.some((e=>n instanceof e));let x,y;const w=new WeakMap,k=new WeakMap,v=new WeakMap;let E={get(n,e,t){if(n instanceof IDBTransaction){if("done"===e)return w.get(n);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return B(n[e])},set:(n,e,t)=>(n[e]=t,!0),has:(n,e)=>n instanceof IDBTransaction&&("done"===e||"store"===e)||e in n};function S(n){E=n(E)}function I(n){return"function"==typeof n?(e=n,(y||(y=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...n){return e.apply(A(this),n),B(this.request)}:function(...n){return B(e.apply(A(this),n))}):(n instanceof IDBTransaction&&function(n){if(w.has(n))return;const e=new Promise(((e,t)=>{const o=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",r),n.removeEventListener("abort",r)},a=()=>{e(),o()},r=()=>{t(n.error||new DOMException("AbortError","AbortError")),o()};n.addEventListener("complete",a),n.addEventListener("error",r),n.addEventListener("abort",r)}));w.set(n,e)}(n),b(n,x||(x=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(n,E):n);var e}function B(n){if(n instanceof IDBRequest)return function(n){const e=new Promise(((e,t)=>{const o=()=>{n.removeEventListener("success",a),n.removeEventListener("error",r)},a=()=>{e(B(n.result)),o()},r=()=>{t(n.error),o()};n.addEventListener("success",a),n.addEventListener("error",r)}));return v.set(e,n),e}(n);if(k.has(n))return k.get(n);const e=I(n);return e!==n&&(k.set(n,e),v.set(e,n)),e}const A=n=>v.get(n),T=["get","getKey","getAll","getAllKeys","count"],D=["put","add","delete","clear"],z=new Map;function P(n,e){if(!(n instanceof IDBDatabase)||e in n||"string"!=typeof e)return;if(z.get(e))return z.get(e);const t=e.replace(/FromIndex$/,""),o=e!==t,a=D.includes(t);if(!(t in(o?IDBIndex:IDBObjectStore).prototype)||!a&&!T.includes(t))return;const r=async function(n,...e){const r=this.transaction(n,a?"readwrite":"readonly");let i=r.store;return o&&(i=i.index(e.shift())),(await Promise.all([i[t](...e),a&&r.done]))[0]};return z.set(e,r),r}S((n=>({...n,get:(e,t,o)=>P(e,t)||n.get(e,t,o),has:(e,t)=>!!P(e,t)||n.has(e,t)})));const C=["continue","continuePrimaryKey","advance"],N={},M=new WeakMap,j=new WeakMap,F={get(n,e){if(!C.includes(e))return n[e];let t=N[e];return t||(t=N[e]=function(...n){M.set(this,j.get(this)[e](...n))}),t}};async function*H(...n){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...n)),!e)return;const t=new Proxy(e,F);for(j.set(t,e),v.set(t,A(e));e;)yield t,e=await(M.get(t)||e.continue()),M.delete(t)}function O(n,e){return e===Symbol.asyncIterator&&b(n,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===e&&b(n,[IDBIndex,IDBObjectStore])}S((n=>({...n,get:(e,t,o)=>O(e,t)?H:n.get(e,t,o),has:(e,t)=>O(e,t)||n.has(e,t)})));const R="stories";async function $(){if(console.log("Attempting to open IndexedDB..."),!("indexedDB"in window))return console.warn("IndexedDB not supported in this browser."),null;try{const n=await function(n,e,{blocked:t,upgrade:o,blocking:a,terminated:r}={}){const i=indexedDB.open(n,e),s=B(i);return o&&i.addEventListener("upgradeneeded",(n=>{o(B(i.result),n.oldVersion,n.newVersion,B(i.transaction),n)})),t&&i.addEventListener("blocked",(n=>t(n.oldVersion,n.newVersion,n))),s.then((n=>{r&&n.addEventListener("close",(()=>r())),a&&n.addEventListener("versionchange",(n=>a(n.oldVersion,n.newVersion,n)))})).catch((()=>{})),s}("story-map-db",1,{upgrade(n,e,t,o){if(console.log(`IndexedDB upgrade from version ${e} to ${t}`),e<1){const e=n.createObjectStore(R,{keyPath:"id"});e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("name","name",{unique:!1}),console.log('Object store "stories" created.')}},blocked(){console.warn("IndexedDB operation blocked. Please close other tabs with this app open.")},blocking(){console.warn("IndexedDB operation blocking. Please close other tabs with this app open.")}});return console.log("IndexedDB opened successfully:",n),n}catch(n){return console.error("Failed to open IndexedDB:",n),null}}async function U(n){const e=await $();if(!e)return;const t=e.transaction(R,"readwrite"),o=t.objectStore(R);try{await o.put(n),await t.done,console.log("Story stored in IndexedDB:",n.id)}catch(n){console.error("Failed to store story in IndexedDB:",n)}}async function V(){const n=await $();if(!n)return[];const e=n.transaction(R,"readonly").objectStore(R);try{const n=await e.getAll();return n.sort(((n,e)=>new Date(e.createdAt)-new Date(n.createdAt))),console.log("Stories retrieved from IndexedDB:",n.length),n}catch(n){return console.error("Failed to get stories from IndexedDB:",n),[]}}const _="https://story-api.dicoding.dev/v1";class G{static async getAll(){const n=await V();if(n.length>0)return console.log("Serving stories from IndexedDB cache."),n;console.log("Fetching stories from network...");const e=await fetch(`${_}/stories`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok){const n=await V();if(n.length>0)return console.warn("Network fetch failed, serving from IndexedDB fallback."),n;throw new Error("Failed to fetch stories and no offline data available.")}const t=(await e.json()).listStory;if(t.length>0){for(const n of t)await U(n);console.log("Stories fetched from network and stored in IndexedDB.")}return t}static async addStory(n){const e=await fetch(`${_}/stories`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:n});if(!e.ok){const n=await e.json();throw new Error(n.message||"Failed to add story")}return await e.json()}}function W(n,e="info"){const t=document.createElement("div");t.className=`toast ${e}`,t.textContent=n,document.body.appendChild(t),setTimeout((()=>t.remove()),3e3)}const q="https://story-api.dicoding.dev/v1";class K{static async login(n,e){try{const t=await fetch(`${q}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:e})});if(!t.ok){const n=await t.json();throw new J(n.message,"LOGIN_FAILED")}const{loginResult:o}=await t.json();return this._saveAuthData(o),o}catch(n){if(n instanceof J)throw n;throw new J("Network error","NETWORK_ERROR")}}static async refreshToken(){const n=localStorage.getItem("refreshToken");if(!n)throw new J("No refresh token","INVALID_REFRESH_TOKEN");try{const e=await fetch(`${q}/refresh-token`,{method:"POST",headers:{Authorization:`Bearer ${n}`}});if(!e.ok)throw this._clearAuthData(),new J("Session expired","SESSION_EXPIRED");const{token:t}=await e.json();return localStorage.setItem("token",t),t}catch(n){throw this._clearAuthData(),new J("Refresh failed","REFRESH_FAILED")}}static async getValidToken(){const n=localStorage.getItem("token");if(!n)throw new J("Not authenticated","UNAUTHENTICATED");const e=JSON.parse(atob(n.split(".")[1]));return Date.now()>=1e3*e.exp-3e5?await this.refreshToken():n}static _saveAuthData({token:n,userId:e,name:t,refreshToken:o}){localStorage.setItem("token",n),localStorage.setItem("refreshToken",o),localStorage.setItem("user",JSON.stringify({userId:e,name:t}))}static _clearAuthData(){localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user")}}class J extends Error{constructor(n,e){super(n),this.name="AuthError",this.code=e}}class Y extends Error{constructor(n,e,t={}){super(n),this.name="AppError",this.type=e,this.metadata=t}}const Z=n=>{switch(console.error(`[${n.type}]`,n.message,n.metadata),n.type){case"AUTH":X(n);break;case"NETWORK":W("Network error. Please check your connection.");break;case"VALIDATION":Q(n.metadata.errors);break;default:W("An unexpected error occurred")}},X=n=>{switch(K._clearAuthData(),n.code){case"SESSION_EXPIRED":W("Session expired. Please login again."),location.hash="#/login";break;case"UNAUTHENTICATED":W("Anda harus login untuk melanjutkan."),location.hash="#/login";break;default:W(`Auth error: ${n.message}`)}},Q=n=>{n.forEach((n=>{const e=document.getElementById(n.field);if(e){e.classList.add("error");const t=e.nextElementSibling;t&&t.classList.contains("error-message")?t.textContent=n.message:(console.warn(`Elemen pesan error untuk bidang '${n.field}' tidak ditemukan di samping input.`),W(`Validasi: ${n.message}`,"error"))}}))};delete L.Icon.Default.prototype._get,L.Icon.Default.mergeOptions({iconRetinaUrl:"/storyApps/assets/icons/marker-icon-2x.webp",iconUrl:"/storyApps/assets/icons/marker-icon.webp",shadowUrl:"/storyApps/assets/icons/marker-shadow.webp"});const nn=L.icon({iconUrl:"/storyApps/assets/icons/marker-icon.webp",iconRetinaUrl:"/storyApps/assets/icons/marker-icon-2x.webp",iconSize:[32,41],iconAnchor:[16,41],popupAnchor:[1,-34],shadowUrl:"/storyApps/assets/icons/marker-shadow.webp",shadowSize:[41,41]}),en={preferCanvas:!0,fadeAnimation:!1,zoomSnap:.5,wheelPxPerZoomLevel:60,inertia:!0,inertiaDeceleration:3e3},tn={maxZoom:19,minZoom:3,reuseTiles:!0,updateWhenIdle:!0,crossOrigin:!0,detectRetina:!0,errorTileUrl:"/storyApps/assets/images/map-error.webp"},on={spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,chunkedLoading:!0,chunkInterval:100,disableClusteringAtZoom:17},an=(n,e=[-2.5489,118.0149],t=4)=>{const o=document.getElementById(n);if(!o)return null;o._map&&o._map.remove();const a=L.map(o,en).setView(e,t);return L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tn).addTo(a).on("tileerror",(n=>{console.error("Error loading tile:",n.tile.src)})),o._map=a,a};let rn=null;function sn(n){rn=n}function dn(){return rn}function ln(n){const e=document.getElementById("mainNav");if(!e)return;e.innerHTML="";let t="";const o=!!localStorage.getItem("token");console.log("--- DEBUG updateAppHeaderNav ---"),console.log("currentPath (RAW):",n),console.log("currentPath (JSON):",JSON.stringify(n)),console.log("Target Path for Stories (EXPECTED):",JSON.stringify("/stories")),console.log("Target Path for Add Story (EXPECTED):",JSON.stringify("/add-story")),console.log("Is Authenticated:",o),o?("/stories"===n?(t+='<button id="addStoryButton">Tambah Story Baru</button>',console.log("Added Tambah Story Baru button HTML.")):"/add-story"===n&&(t+='<button id="backToStoriesButton" onclick="location.hash=\'#/stories\'">Kembali ke Stories</button>',console.log("Added Kembali ke Stories button HTML.")),t+='<button id="logoutButton">Logout</button>',console.log("Added Logout button HTML.")):"/login"===n?t+='<button id="registerPageButton" onclick="location.hash=\'#/register\'">Daftar</button>':"/register"===n&&(t+='<button id="loginPageButton" onclick="location.hash=\'#/login\'">Login</button>'),console.log("Final buttonsHtml:",t),e.innerHTML=t,document.getElementById("addStoryButton")&&document.getElementById("addStoryButton").addEventListener("click",(()=>{location.hash="#/add-story"})),document.getElementById("logoutButton")&&document.getElementById("logoutButton").addEventListener("click",(()=>{localStorage.clear(),location.hash="#/login"}))}function cn(){const n=document.getElementById("app");n?(n.innerHTML='\n            <main id="main">\n                <h1>Login</h1>\n                <form id="loginForm" class="form-container">\n                    <label for="email">Email:</label>\n                    <input type="email" id="email" name="email" required>\n                    <label for="password">Password:</label>\n                    <input type="password" id="password" name="password" required>\n                    <button type="submit">Login</button>\n                </form>\n                <p>Belum punya akun? <a href="#/register">Daftar di sini</a></p>\n            </main>\n        ',document.getElementById("loginForm").addEventListener("submit",gn.handleLogin)):console.error("Elemen #app tidak ditemukan di showLogin!"),ln("#/login")}function pn(){document.getElementById("app").innerHTML='\n        <main id="main">\n            <h1>Tambah Story Baru</h1>\n            <form id="addStoryForm" class="form-container">\n                <label for="description">Deskripsi:</label>\n                <textarea id="description" required></textarea>\n                <div class="error-message" id="description-error"></div>\n                <label for="photo">Foto:</label>\n                <div class="photo-input">\n                    <input type="file" id="photo" accept="image/*" capture="environment">\n                    <button type="button" id="openCamera">Ambil Foto</button>\n                </div>\n                <div class="error-message" id="photo-error"></div>\n                <div id="map" style="height: 300px;"></div>\n                <div id="coordinates">Pilih lokasi di peta (opsional)</div>\n                <input type="hidden" id="lat" name="lat">\n                <input type="hidden" id="lon" name="lon">\n\n                <button type="submit">Submit Story</button>\n            </form>\n        </main>\n    ',sn(null),mn(),function(){if(!document.getElementById("map"))return void console.error("Kontainer peta tidak ditemukan untuk halaman tambah story.");const n=an("map",[-2.5489,118.0149],4);if(n){const e=document.getElementById("lat"),t=document.getElementById("lon"),o=document.getElementById("coordinates");((n,e)=>{if(!n)return;let t=null;n.on("click",(o=>{const{lat:a,lng:r}=o.latlng;t&&n.removeLayer(t),t=L.marker([a,r],{icon:nn,draggable:!0,title:"Lokasi dipilih",alt:"Marker lokasi story"}).addTo(n),e(a,r),t.on("dragend",(n=>{const t=n.target.getLatLng();e(t.lat,t.lng)}))}))})(n,((n,a)=>{e&&t&&o&&(e.value=n,t.value=a,o.textContent=`Lat: ${n.toFixed(4)}, Lon: ${a.toFixed(4)}`)})),(n=>new Promise(((e,t)=>{if(!n)return t("Map not initialized");n.locate({setView:!0,maxZoom:16,enableHighAccuracy:!0,timeout:1e4}).on("locationfound",(t=>{const{lat:o,lng:a}=t.latlng;L.marker([o,a],{icon:nn,title:"Lokasi Anda",alt:"Marker lokasi user"}).addTo(n).bindPopup("Anda berada di sini").openPopup(),e({lat:o,lng:a})})).on("locationerror",(n=>{console.error("Geolocation error:",n.message),t(n.message)}))})))(n).then((({lat:n,lng:a})=>{e&&t&&o&&(e.value=n,t.value=a,o.textContent=`Lokasi Anda: Lat: ${n.toFixed(4)}, Lon: ${a.toFixed(4)}`)})).catch((n=>{W(`Tidak dapat menemukan lokasi Anda: ${n}`,"info"),console.warn("Geolocation gagal:",n)}))}}(),document.getElementById("addStoryForm").addEventListener("submit",hn.handleAddStory),ln("#/add-story")}function mn(){let n;document.getElementById("openCamera").addEventListener("click",(async()=>{try{n=await navigator.mediaDevices.getUserMedia({video:!0});const e=document.querySelector(".photo-input");if(!e)return console.error("Elemen .photo-input tidak ditemukan."),void W("Elemen input foto tidak ditemukan.","error");e.innerHTML='\n                <video id="cameraVideo" style="width: 100%; max-width: 300px; display: block; margin: 10px auto;" autoplay playsinline></video>\n                <div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">\n                    <button type="button" id="capture">Capture</button>\n                    <button type="button" id="cancelCamera">Batal</button>\n                </div>\n            ';const t=document.getElementById("cameraVideo");if(!t)return console.error("Elemen video kamera tidak ditemukan."),void W("Video kamera tidak dapat ditampilkan.","error");t.srcObject=n,t.play(),t.onplaying=()=>{document.getElementById("capture").addEventListener("click",(()=>{const e=document.createElement("canvas");e.width=t.videoWidth,e.height=t.videoHeight,e.getContext("2d").drawImage(t,0,0),e.toBlob((t=>{const o=new File([t],"captured_photo.jpg",{type:"image/jpeg"});sn(o),console.log("--- DEBUGGING CAMERA FILE ---"),console.log("Captured File Object:",o),console.log("File name:",o.name),console.log("File size:",o.size,"bytes"),console.log("File type:",o.type),console.log("File dimensions (canvas):",e.width,"x",e.height),console.log("File disimpan ke _capturedPhotoFile global.");const a=new FileReader;a.onloadend=()=>{const n=document.createElement("img");n.src=a.result,n.style.maxWidth="150px",n.style.height="auto",n.style.border="3px solid red",n.style.marginTop="20px",n.style.marginBottom="20px",n.style.display="block",n.style.margin="20px auto",n.id="debug-camera-preview";const e=document.querySelector("main#main");if(e){const t=document.getElementById("debug-camera-preview");t&&t.remove(),e.appendChild(n)}else console.warn("Could not find main#main to append debug image preview.");console.log("Gambar kamera preview (DataURL substring):",a.result.substring(0,50)+"..."),console.log("--- END DEBUGGING CAMERA FILE ---")},a.readAsDataURL(o),n.getTracks().forEach((n=>n.stop()));const r=document.createElement("div");r.className="photo-input",r.innerHTML='\n                            <input type="file" id="photo" accept="image/*" capture="environment">\n                            <button type="button" id="openCamera">Ambil Foto</button>\n                            <span style="font-size: 0.9em; color: green; margin-left: 5px;">Foto diambil!</span>\n                        ',document.querySelector(".form-container .photo-input").replaceWith(r),mn()}),"image/jpeg",.8)})),document.getElementById("cancelCamera")?.addEventListener("click",(()=>{n.getTracks().forEach((n=>n.stop())),sn(null);const t=document.createElement("div");t.className="photo-input",t.innerHTML='\n                        <input type="file" id="photo" accept="image/*" capture="environment">\n                        <button type="button" id="openCamera">Ambil Foto</button>\n                    ',e.replaceWith(t),mn()}))}}catch(n){W("Akses kamera ditolak atau gagal: "+n.message,"error"),console.error("Kesalahan akses kamera:",n)}}))}let un=null;class gn{static async handleLogin(n){n.preventDefault();const e=n.target.email.value,t=n.target.password.value;try{await K.login(e,t),document.startViewTransition?document.startViewTransition((()=>{location.hash="#/stories"})):location.hash="#/stories"}catch(n){Z(new Y(n.message,"AUTH",{code:n.code,originalError:n}))}}static async handleRegister(n){n.preventDefault();const e=n.target.name.value,t=n.target.email.value,o=n.target.password.value;try{const n=await fetch("https://story-api.dicoding.dev/v1/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:o})});if(!n.ok){const e=await n.json();throw new Y(e.message||"Gagal mendaftar","AUTH",{originalError:e})}W("Registrasi berhasil! Silakan login.","success"),document.startViewTransition?document.startViewTransition((()=>{location.hash="#/login"})):location.hash="#/login"}catch(n){Z(new Y(n.message,"AUTH",{code:n.code,originalError:n}))}}static async checkAuth(){try{return await K.getValidToken(),!0}catch(n){return Z(new Y("Authentication required","AUTH",{code:"UNAUTHENTICATED"})),!1}}}class hn{static async loadStories(){try{const n=await G.getAll();this.renderStories(n),document.getElementById("map")&&this.renderMap(n)}catch(n){console.error("Gagal memuat stories:",n),W("Gagal memuat story. Coba lagi nanti.","error"),Z(new Y(n.message,"NETWORK",{originalError:n}))}}static async handleAddStory(n){n.preventDefault();const e=n.target,t=e.querySelector("#description").value,o=e.querySelector("#lat")?.value,a=e.querySelector("#lon")?.value;let r=null;const i=e.querySelector("#photo");dn()?(r=dn(),console.log("Foto diambil dari kamera (via getter).")):i&&i.files[0]?(r=i.files[0],console.log("Foto dipilih dari input lokal.")):console.log("Tidak ada file foto yang dipilih (akan ditangkap validasi jika wajib).");const s=((n,e)=>{const t=[];return e.length<10&&t.push("Deskripsi minimal 10 karakter"),n&&(n.size>1e6&&t.push("Ukuran foto maksimal 1MB"),["image/jpeg","image/png","image/webp"].includes(n.type)||t.push("Format foto harus JPEG, PNG, atau WebP")),{isValid:0===t.length,errors:t}})(r,t);if(!s.isValid)return void s.errors.forEach((n=>W(n,"error")));const d=new FormData;d.append("description",t),r&&(d.append("photo",r),console.log("Foto ditambahkan ke FormData.")),o&&a&&(d.append("lat",o),d.append("lon",a));try{await G.addStory(d),e.reset(),W("Story baru berhasil ditambahkan!","success"),sn(null),document.startViewTransition?document.startViewTransition((()=>{location.hash="#/stories"})):location.hash="#/stories"}catch(n){console.error("Gagal menambahkan story:",n),W(`Gagal: ${n.message}`,"error"),Z(new Y(n.message,"API_ERROR",{originalError:n}))}}static async clearAllStories(){try{await async function(){const n=await $();if(!n)return;const e=n.transaction(R,"readwrite"),t=e.objectStore(R);try{await t.clear(),await e.done,console.log("All stories cleared from IndexedDB.")}catch(n){console.error("Failed to clear stories from IndexedDB:",n)}}(),W("Semua cerita offline telah dihapus!","info"),this.loadStories()}catch(n){console.error("Gagal menghapus cerita offline:",n),W("Gagal menghapus cerita offline.","error"),Z(new Y(n.message,"DB_ERROR",{originalError:n}))}}static renderStories(n){const e=document.getElementById("storiesList");e&&(e.innerHTML=n.map((n=>`\n          <article class="story-card" aria-labelledby="story-${n.id}">\n            <img\n              src="${n.photoUrl}"\n              alt="${n.description||"Story image"}"\n              loading="lazy"\n            >\n            <div class="story-content">\n              <h3 id="story-${n.id}">${n.name}</h3>\n              <p>${n.description}</p>\n              <time datetime="${n.createdAt}">\n                ${new Date(n.createdAt).toLocaleDateString("id-ID")}\n              </time>\n              ${n.lat&&n.lon?`\n                  <div class="map-marker" data-lat="${n.lat}" data-lon="${n.lon}">\n                    üìç Lokasi\n                  </div>\n                `:""}\n            </div>\n          </article>\n        `)).join(""))}static renderMap(n){const e=document.getElementById("map");if(!e)return;const t=e.querySelector(".map-loader");t&&t.remove(),un||(un=an("map")),un&&(un._markerCluster&&un.removeLayer(un._markerCluster),((n,e=[])=>{if(!n||!e.length)return;n._markerCluster&&n.removeLayer(n._markerCluster);const t=L.markerClusterGroup(on);if(e.forEach((n=>{if(!n.lat||!n.lon)return;const e=L.marker([n.lat,n.lon],{icon:nn,riseOnHover:!0,title:n.name,alt:`Lokasi story ${n.name}`,keyboard:!0}),o=`\n      <div class="popup-content">\n        <h3>${n.name}</h3>\n        <img src="/storyApps/assets/images/placeholder.webp"\n             data-src="${n.photoUrl}"\n             alt="${n.description||"Story image"}"\n             loading="lazy"\n             class="story-image"\n             width="200"\n             height="150">\n        <p>${n.description}</p>\n        <small>${new Date(n.createdAt).toLocaleDateString()}</small>\n      </div>\n    `;e.bindPopup(o,{maxWidth:300,minWidth:200,autoPan:!0}),e.on("popupopen",(()=>{const n=document.querySelector(".popup-content img");n&&n.dataset.src&&(n.src=n.dataset.src)})),t.addLayer(e)})),n.addLayer(t),n._markerCluster=t,e.some((n=>n.lat&&n.lon))){const e=t.getBounds();e.isValid()&&n.fitBounds(e,{padding:[50,50],maxZoom:15})}})(un,n))}}const fn={"/login":()=>cn(),"/register":()=>function(){const n=document.getElementById("app");n?(n.innerHTML='\n            <main id="main">\n                <h1>Daftar Akun Baru</h1>\n                <form id="registerForm" class="form-container">\n                    <label for="name">Nama:</label>\n                    <input type="text" id="name" name="name" required>\n                    <label for="email">Email:</label>\n                    <input type="email" id="email" name="email" required>\n                    <label for="password">Password:</label>\n                    <input type="password" id="password" name="password" required>\n                    <button type="submit">Daftar</button>\n                </form>\n                <p>Sudah punya akun? <a href="#/login">Login di sini</a></p>\n            </main>\n        ',document.getElementById("registerForm").addEventListener("submit",gn.handleRegister)):console.error("Elemen #app tidak ditemukan di showRegister!"),ln("#/register")}(),"/stories":async()=>{await gn.checkAuth()?function(){const n=document.getElementById("app");n?(n.innerHTML='\n            <main id="main">\n                <h1>Story Terbaru</h1>\n                <div id="map" style="height: 400px; width: 100%;">\n                    <div class="map-loader loading-spinner"></div>\n                </div>\n                <h2>Daftar Story</h2>\n                <button id="clearStoriesButton" class="clear-data-button">Hapus Semua Cerita Offline</button>                \n                <div class="story-grid" id="storiesList">\n                    <p style="text-align: center; color: #666;">Memuat cerita...</p>\n                </div>\n            </main>\n        ',document.getElementById("clearStoriesButton").addEventListener("click",(()=>{hn.clearAllStories()})),hn.loadStories()):console.error("Elemen #app tidak ditemukan di showStories!"),ln("#/stories")}():cn()},"/add-story":async()=>{await gn.checkAuth()?pn():(location.hash="#/login",cn())}};async function bn(){const n=window.location.hash.substring(1)||"/stories",e=fn[n];e?document.startViewTransition?document.startViewTransition((async()=>{await e(),ln(n)})):(await e(),ln(n)):location.hash="#/stories"}window.addEventListener("hashchange",bn),window.addEventListener("load",bn)})();